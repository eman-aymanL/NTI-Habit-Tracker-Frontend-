<div
  class="group relative overflow-hidden rounded-2xl bg-white/70 dark:bg-gray-900/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-gray-900/60 ring-1 ring-black/5 dark:ring-white/10 shadow-sm hover:shadow-md transition-all duration-200 ease-out hover:-translate-y-0.5"
  [class.py-3]="compact"
  [class.py-4]="!compact"
  [class.px-3]="compact"
  [class.px-4]="!compact"
>
  <div class="flex items-start gap-3">
    <!-- Icon block -->
    <div class="shrink-0 mt-1">
      <div
        class="size-10 rounded-xl grid place-items-center text-white shadow-sm"
        [ngStyle]="{ background: habit?.color || 'linear-gradient(135deg,#4f46e5,#22d3ee)' }"
      >
        @if (habit?.icon) {
        <fa-icon [icon]="['fas', habit!.icon!]" class="text-lg leading-none"></fa-icon>
        } @else {
        <span class="text-sm font-bold">âœ“</span>
        }
      </div>
    </div>

    <!-- Content -->
    <div class="min-w-0 flex-1">
      <div class="flex items-center gap-2">
        <h3 class="truncate text-sm font-semibold text-gray-900 dark:text-gray-100">
          {{ habit?.title || 'Habit' }}
        </h3>

        <!-- Frequency Badge -->
        <span
          class="inline-flex items-center rounded-md px-1.5 py-0.5 text-[10px] font-medium ring-1 ring-inset"
          [class.bg-indigo-50]="habit?.frequency === 'daily'"
          [class.text-indigo-700]="habit?.frequency === 'daily'"
          [class.ring-indigo-200]="habit?.frequency === 'daily'"
          [class.bg-emerald-50]="habit?.frequency === 'weekly'"
          [class.text-emerald-700]="habit?.frequency === 'weekly'"
          [class.ring-emerald-200]="habit?.frequency === 'weekly'"
          [class.bg-amber-50]="habit?.frequency === 'custom'"
          [class.text-amber-700]="habit?.frequency === 'custom'"
          [class.ring-amber-200]="habit?.frequency === 'custom'"
        >
          {{ frequencyLabel }}
        </span>

        <!-- Archived Badge -->
        @if (habit?.archived) {
        <span
          class="ml-1 text-[10px] rounded-md bg-gray-100 text-gray-600 px-1.5 py-0.5 ring-1 ring-gray-200"
        >
          Archived
        </span>
        }
      </div>

      @if (habit?.description) {
      <p class="mt-1 line-clamp-2 text-xs text-gray-600 dark:text-gray-400">
        {{ habit?.description }}
      </p>
      }

      <!-- Progress -->
      <div class="mt-3">
        <div class="flex items-center justify-between text-[11px] text-gray-500 dark:text-gray-400">
          <span>
            Streak:
            <span class="font-semibold text-gray-700 dark:text-gray-200">{{ streak }}</span> days
          </span>
          <span>{{ completionPercent }}%</span>
        </div>
        <div
          class="mt-1 h-2 w-full rounded-full bg-gray-100 dark:bg-gray-800 ring-1 ring-inset ring-black/5 dark:ring-white/10 overflow-hidden"
        >
          <div
            class="h-full rounded-full bg-gradient-to-r from-indigo-500 to-cyan-400 transition-all"
            [style.width.%]="completionPercent"
          ></div>
        </div>
      </div>
    </div>

    <!-- Quick toggle today -->
    <button
      type="button"
      class="ml-auto rounded-xl p-2 ring-1 ring-inset ring-black/5 dark:ring-white/10 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 ease-out hover:-translate-y-0.5 active:scale-95"
      [ngClass]="isDoneToday ? 'bg-emerald-50 text-emerald-700 ring-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-300 dark:ring-emerald-900/40' : ''"
      [attr.aria-pressed]="isDoneToday"
      (click)="onToggleToday()"
      [title]="isDoneToday ? 'Undo today' : 'Mark done today'"
    >
      @if (isDoneToday) {
      <!-- Undo / U-turn left icon -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-5">
        <path
          d="M9 15l-6-6m0 0l6-6M3 9h12a6 6 0 1 1 0 12h-3"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      } @else {
      <!-- Check icon -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-5">
        <path d="m4.5 12.75 6 6 9-13.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      }
    </button>
  </div>

  <!-- Actions -->
  @if (showActions) {
  <div class="mt-3 flex items-center gap-1.5">
    <!-- Edit button -->
    <button
      type="button"
      (click)="onEdit()"
      class="inline-flex items-center gap-1 rounded-lg px-2.5 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 ring-1 ring-inset ring-gray-200 dark:ring-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 ease-out hover:-translate-y-0.5 active:scale-95"
    >
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-4">
        <path
          d="M16.862 4.487a2.1 2.1 0 1 1 2.97 2.97L8.85 18.44l-4.35 1.38 1.38-4.35 11.003-10.983z"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      Edit
    </button>

    <!-- Archive button -->
    <button
      type="button"
      (click)="onArchiveToggle()"
      class="inline-flex items-center gap-1 rounded-lg px-2.5 py-1.5 text-xs font-medium text-indigo-700 dark:text-indigo-300 ring-1 ring-inset ring-indigo-200 dark:ring-indigo-900/40 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-all duration-200 ease-out hover:-translate-y-0.5 active:scale-95"
    >
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-4">
        <path
          d="M3 7h18M5 7v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      {{ habit?.archived ? 'Unarchive' : 'Archive' }}
    </button>

    <!-- Delete button -->
    <button
      type="button"
      (click)="onRemove()"
      class="ml-auto inline-flex items-center gap-1 rounded-lg px-2.5 py-1.5 text-xs font-medium text-rose-700 dark:text-rose-300 ring-1 ring-inset ring-rose-200 dark:ring-rose-900/40 hover:bg-rose-50 dark:hover:bg-rose-900/20 transition-all duration-200 ease-out hover:-translate-y-0.5 active:scale-95"
    >
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="size-4">
        <path
          d="M6 7h12m-1 0-.867 12.142A2 2 0 0 1 14.138 21H9.862a2 2 0 0 1-1.995-1.858L7 7m3 4v6m4-6v6M9 7h6m-3-3a2 2 0 0 1 2 2H7a2 2 0 0 1 2-2h6z"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      Delete
    </button>
  </div>
  }
</div>
