<div class="container mx-auto p-6 max-w-6xl min-h-screen">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">My Habits</h1>
    </div>

    <button
      (click)="openPopup()"
      class="group relative inline-flex items-center justify-center gap-2 rounded-xl bg-indigo-600 px-5 py-2.5 font-semibold text-white shadow-sm shadow-indigo-600/20 transition-all duration-200 hover:-translate-y-0.5 hover:bg-indigo-500 active:translate-y-0 active:scale-95 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500"
    >
      <i class="fa-solid fa-plus"></i>
      <span>Add New Habit</span>
    </button>
  </div>

  @if (successMessage) {
  <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
    {{ successMessage }}
  </div>
}

@if (errorMessage) {
  <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
    {{ errorMessage }}
  </div>
  }

  <div
    class="bg-white dark:bg-gray-900 p-4 rounded-lg shadow-md mb-6 border border-gray-200 dark:border-gray-800"
  >
    <div class="flex flex-wrap gap-4 items-center">
      <div>
        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300"
          >Filter by Status</label
        >
        <select
          [(ngModel)]="filterStatus"
          (change)="applyFilters()"
          class="border border-gray-300 dark:border-gray-800 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-2 rounded w-32"
        >
          <option value="active">Active</option>
          <option value="archived">Archived</option>
          <option value="all">All</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300"
          >Sort by</label
        >
        <select
          [(ngModel)]="sortBy"
          (change)="applyFilters()"
          class="border border-gray-300 dark:border-gray-800 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-2 rounded w-32"
        >
          <option value="newest">Newest</option>
          <option value="oldest">Oldest</option>
          <option value="progress">Progress</option>
        </select>
      </div>

      <div class="ml-auto">
        <span class="text-sm text-gray-600 dark:text-gray-400">
          Showing {{ filteredHabits.length }} of {{ habits.length }} habits
        </span>
      </div>
    </div>
  </div>


  
  @if (isLoading && habits.length === 0) {
  <div class="text-center py-16">
    <div
      class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"
    ></div>
    <p class="mt-4 text-gray-600">Loading your habits...</p>
  </div>
  } @if (!isLoading && filteredHabits.length === 0) {
  <div
    class="text-center py-16 bg-white dark:bg-gray-900 rounded-lg shadow border border-gray-200 dark:border-gray-800"
  >
    <div class="text-gray-400 mb-4">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-20 w-20 mx-auto"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
        />
      </svg>
    </div>
    <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2">No habits found</h3>
    <p class="text-gray-500 dark:text-gray-400 mb-6">
      {{
        filterStatus === 'archived'
          ? "You don't have any archived habits yet"
          : 'Start by adding your first habit to track your progress'
      }}
    </p>

    @if (filterStatus !== 'archived') {
    <button
      routerLink="/habits/new"
      class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-500 transition"
    >
      Create Your First Habit
    </button>
    }
  </div>
  } @if (!isLoading && filteredHabits.length > 0) {
  <div class="grid gap-4 md:gap-6 md:grid-cols-2 lg:grid-cols-3">
    @for (habit of filteredHabits; track habit._id) {
    <app-habit-card
      [habit]="habit"
      (toggleToday)="onToggleToday($event)"
      (edit)="onEditHabit($event)"
      (remove)="onDeleteHabit($event)"
      (archiveToggle)="toggleArchive($event)"
    ></app-habit-card>
    }
  </div>
  }
</div>

<!-- Popup Component -->
<app-habit-popup 
  [isOpen]="showPopup" 
  (close)="closePopup()"
  (habitCreated)="onHabitCreated($event)">
</app-habit-popup>