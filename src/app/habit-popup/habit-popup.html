<div *ngIf="isOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <!-- Header -->
    <div class="flex justify-between items-center p-6 border-b">
      <div>
        <h2 class="text-2xl font-bold text-gray-800">Create New Habit</h2>
        <p class="text-gray-600 mt-1">Add a new habit to track your progress</p>
      </div>
      <button (click)="close()" class="text-gray-400 hover:text-gray-600 text-2xl">
        &times;
      </button>
    </div>

    <!-- Messages -->
    <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 mx-6 mt-4 rounded">
      {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 mx-6 mt-4 rounded">
      {{ successMessage }}
    </div>

    <!-- Form -->
    <form (ngSubmit)="onSubmit()" class="p-6 space-y-6">
      <!-- Title -->
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700">
          Title *
        </label>
        <input
          type="text"
          [(ngModel)]="habit.title"
          name="title"
          required
          class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="e.g., Exercise, Reading, Meditation"
        >
      </div>

      <!-- Description -->
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700">
          Description
        </label>
        <textarea
          [(ngModel)]="habit.description"
          name="description"
          rows="3"
          class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="Brief description of your habit..."
        ></textarea>
      </div>

      <!-- Frequency -->
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700">
          Frequency *
        </label>
        <select
          [(ngModel)]="habit.frequency"
          name="frequency"
          (change)="onFrequencyChange()"
          class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="custom">Custom</option>
        </select>
      </div>

      <!-- Days Selection (for custom frequency) -->
      <div *ngIf="habit.frequency === 'custom'">
        <label class="block text-sm font-medium mb-2 text-gray-700">
          Select Days *
        </label>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
          <label *ngFor="let day of daysOfWeek" class="flex items-center">
            <input
              type="checkbox"
              [checked]="day.selected"
              (change)="toggleDaySelection(day)"
              class="mr-2 h-4 w-4 text-blue-600 rounded"
            >
            <span class="text-sm text-gray-700">{{ day.name }}</span>
          </label>
        </div>
      </div>

      <!-- Reminder Time -->
      <!-- <div>
        <label class="block text-sm font-medium mb-2 text-gray-700">
          Reminder Time (Optional)
        </label>
        <input
          type="time"
          [(ngModel)]="habit.reminderTime"
          name="reminderTime"
          class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div> -->

      <!-- Color -->
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700">
          Color (Optional)
        </label>
        <div class="flex items-center space-x-4">
          <input
            type="color"
            [(ngModel)]="habit.color"
            name="color"
            class="w-16 h-10 p-1 border border-gray-300 rounded-lg"
          >
          <span class="text-sm text-gray-600">Selected color: {{ habit.color }}</span>
        </div>
      </div>

      <!-- Dates -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700">
            Start Date (Optional)
          </label>
          <input
            type="date"
            [(ngModel)]="habit.startDate"
            name="startDate"
            class="w-full border border-gray-300 p-3 rounded-lg"
          >
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700">
            End Date (Optional)
          </label>
          <input
            type="date"
            [(ngModel)]="habit.endDate"
            name="endDate"
            class="w-full border border-gray-300 p-3 rounded-lg"
          >
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end space-x-4 pt-6 border-t">
        <button
          type="button"
          (click)="close()"
          class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="isLoading"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-300 transition"
        >
          {{ isLoading ? 'Creating...' : 'Create Habit' }}
        </button>
      </div>
    </form>
  </div>
</div>